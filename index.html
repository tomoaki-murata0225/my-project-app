<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿œå‹Ÿè€…è‡ªå‹•è¿”ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’é©ç”¨ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container bg-white p-8 rounded-xl shadow-lg w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">å¿œå‹Ÿè€…è‡ªå‹•è¿”ä¿¡ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h1>

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼IDè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="userIdDisplay" class="text-sm text-gray-600 mb-4 text-center"></div>

        <form id="applicationForm" class="space-y-6">
            <div>
                <label for="applicantName" class="block text-gray-700 text-sm font-semibold mb-2">ãŠåå‰</label>
                <input type="text" id="applicantName" name="applicantName" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"
                       placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ">
            </div>
            <div>
                <label for="applicantEmail" class="block text-gray-700 text-sm font-semibold mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                <input type="email" id="applicantEmail" name="applicantEmail" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"
                       placeholder="ä¾‹ï¼šyour.email@example.com">
            </div>
            <div>
                <label for="jobTitle" class="block text-gray-700 text-sm font-semibold mb-2">å¿œå‹Ÿè·ç¨®</label>
                <input type="text" id="jobTitle" name="jobTitle" required
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"
                       placeholder="ä¾‹ï¼šå–¶æ¥­è·">
            </div>
            <!-- æ€§åˆ¥ -->
            <div>
                <label for="applicantGender" class="block text-gray-700 text-sm font-semibold mb-2">æ€§åˆ¥</label>
                <select id="applicantGender" name="applicantGender" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="ç”·æ€§">ç”·æ€§</option>
                    <option value="å¥³æ€§">å¥³æ€§</option>
                    <option value="ãã®ä»–">ãã®ä»–</option>
                </select>
            </div>
            <!-- å¹´ä»£ -->
            <div>
                <label for="applicantAgeGroup" class="block text-gray-700 text-sm font-semibold mb-2">å¹´ä»£</label>
                <select id="applicantAgeGroup" name="applicantAgeGroup" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="10ä»£">10ä»£</option>
                    <option value="20ä»£">20ä»£</option>
                    <option value="30ä»£">30ä»£</option>
                    <option value="40ä»£">40ä»£</option>
                    <option value="50ä»£">50ä»£</option>
                    <option value="60ä»£ä»¥ä¸Š">60ä»£ä»¥ä¸Š</option>
                </select>
            </div>
            <!-- å¤‰æ›´ã•ã‚ŒãŸé …ç›®ï¼šWEBé¢è«‡å¸Œæœ›æ—¥ -->
            <div>
                <label for="desiredInterviewDates" class="block text-gray-700 text-sm font-semibold mb-2">WEBé¢è«‡å¸Œæœ›æ—¥</label>
                <textarea id="desiredInterviewDates" name="desiredInterviewDates" rows="5"
                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out"
                          placeholder="ä¾‹ï¼š
ãƒ»2025å¹´7æœˆ20æ—¥(æ—¥) 10:00ï½
ãƒ»2025å¹´7æœˆ21æ—¥(æœˆ) 14:00ï½
ãƒ»2025å¹´7æœˆ22æ—¥(ç«) 16:00ï½
â€»æ‰€è¦æ™‚é–“30åˆ†"></textarea>
            </div>
            <button type="submit"
                    class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                å¿œå‹Ÿã™ã‚‹
            </button>
        </form>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
        <div id="loadingIndicator" class="hidden text-center mt-6">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto"></div>
            <p class="mt-3 text-gray-600">è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ã‚’ç”Ÿæˆä¸­...</p>
        </div>

        <!-- è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="emailOutput" class="mt-8 p-6 bg-gray-50 border border-gray-200 rounded-xl hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ç”Ÿæˆã•ã‚ŒãŸè‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</h2>
            <div class="whitespace-pre-wrap text-gray-700" id="emailContent"></div>
            <a id="googleCalendarLink" target="_blank" rel="noopener noreferrer"
               class="hidden mt-6 w-full text-center bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-300 ease-in-out transform hover:scale-105">
                ğŸ—“ï¸ Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«è¿½åŠ 
            </a>
            <button id="closeEmailOutput"
                    class="mt-6 w-full bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-50 transition duration-300 ease-in-out">
                é–‰ã˜ã‚‹
            </button>
        </div>

        <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="errorMessage" class="hidden mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg" role="alert">
            <p class="font-bold">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>
            <p id="errorText"></p>
        </div>
    </div>

    <script type="module">
        // Firebase SDKã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦æä¾›ã•ã‚Œã‚‹Firebaseè¨­å®šã¨èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let auth;
        let db;
        let currentUserId = 'unknown'; // Initial value

        const userIdDisplay = document.getElementById('userIdDisplay');
        const applicationForm = document.getElementById('applicationForm');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const emailOutput = document.getElementById('emailOutput');
        const emailContent = document.getElementById('emailContent');
        const closeEmailOutputButton = document.getElementById('closeEmailOutput');
        const googleCalendarLink = document.getElementById('googleCalendarLink'); // New Google Calendar link element
        const errorMessageDiv = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const desiredInterviewDatesTextarea = document.getElementById('desiredInterviewDates'); // Textarea for desired interview dates

        /**
         * Initializes Firebase and monitors authentication state.
         */
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length > 0) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);

                    // Monitor authentication state changes
                    onAuthStateChanged(auth, (user) => {
                        if (user) {
                            currentUserId = user.uid;
                            userIdDisplay.textContent = `ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ${currentUserId}`;
                            console.log("Firebase User ID:", currentUserId);
                        } else {
                            // If user signs out or anonymous authentication fails
                            currentUserId = crypto.randomUUID(); // Generate anonymous user ID
                            userIdDisplay.textContent = `ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (åŒ¿å): ${currentUserId}`;
                            console.log("Firebase user not signed in. Anonymous ID:", currentUserId);
                        }
                    });

                    // Use initial auth token if available, otherwise sign in anonymously
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Signed in with custom token.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously.");
                    }
                } else {
                    console.warn("Firebase configuration not provided. Firebase features will not be available.");
                    userIdDisplay.textContent = `Firebaseã¯åˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚åŒ¿åID: ${crypto.randomUUID()}`;
                }
            } catch (error) {
                console.error("Firebase initialization or authentication error:", error);
                showError("Firebaseã®åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
                userIdDisplay.textContent = `Firebaseã‚¨ãƒ©ãƒ¼ã€‚åŒ¿åID: ${crypto.randomUUID()}`;
            }
        }

        /**
         * Displays an error message.
         * @param {string} message - The error message to display.
         */
        function showError(message) {
            errorText.textContent = message;
            errorMessageDiv.classList.remove('hidden');
            loadingIndicator.classList.add('hidden');
            emailOutput.classList.add('hidden');
            googleCalendarLink.classList.add('hidden'); // Hide calendar link on error
        }

        /**
         * Hides the error message.
         */
        function hideError() {
            errorMessageDiv.classList.add('hidden');
            errorText.textContent = '';
        }

        /**
         * Parses a date string and returns a Date object.
         * Attempts to parse formats like "YYYYå¹´MæœˆDæ—¥(æ›œæ—¥) H:Mï½".
         * @param {string} dateString - The date string to parse.
         * @returns {Date|null} Parsed Date object or null if parsing fails.
         */
        function parseJapaneseDate(dateString) {
            const match = dateString.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥\(.+\)\s*(\d{1,2}):(\d{2})ï½?/);
            if (match) {
                const year = parseInt(match[1]);
                const month = parseInt(match[2]) - 1; // Month is 0-indexed
                const day = parseInt(match[3]);
                const hour = parseInt(match[4]);
                const minute = parseInt(match[5]);
                return new Date(year, month, day, hour, minute);
            }
            return null;
        }

        /**
         * Formats a Date object to Google Calendar's required datetime format (YYYYMMDDTHHMMSSZ).
         * Assumes local time and converts to UTC for the link.
         * @param {Date} date - The Date object to format.
         * @returns {string} Formatted datetime string.
         */
        function formatGoogleCalendarDateTime(date) {
            if (!date) return '';
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            const seconds = date.getSeconds().toString().padStart(2, '0');
            return `${year}${month}${day}T${hours}${minutes}${seconds}`;
        }

        /**
         * Creates a Google Calendar event URL.
         * @param {string} applicantName - The name of the applicant.
         * @param {string} jobTitle - The job title applied for.
         * @param {string} desiredDatesText - The raw text from the desired interview dates textarea.
         * @returns {string} The Google Calendar event URL.
         */
        function createGoogleCalendarLink(applicantName, jobTitle, desiredDatesText) {
            const eventTitle = encodeURIComponent(`WEBé¢è«‡: ${applicantName}æ§˜ (${jobTitle})`);
            const eventDetails = encodeURIComponent(`äººæç´¹ä»‹ä¼šç¤¾ã«ã‚ˆã‚‹WEBé¢è«‡ã§ã™ã€‚\n\nå¿œå‹Ÿè€…: ${applicantName}æ§˜\nå¿œå‹Ÿè·ç¨®: ${jobTitle}\n\nå¸Œæœ›æ—¥: ${desiredDatesText || 'æœªå®š'}\n\næ‰€è¦æ™‚é–“: 30åˆ†`); // è©³ç´°ã«æ‰€è¦æ™‚é–“ã‚’å¤‰æ›´
            const location = encodeURIComponent('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é¢è«‡ (URLã¯åˆ¥é€”ã”é€£çµ¡)');

            let startDate = new Date(); // Default to now
            let endDate = new Date(startDate.getTime() + 30 * 60 * 1000); // Default to 30 minutes later

            // Try to parse the first line of desiredDatesText
            const firstLine = desiredDatesText.split('\n')[0].trim();
            const parsedDate = parseJapaneseDate(firstLine);

            if (parsedDate) {
                startDate = parsedDate;
                endDate = new Date(startDate.getTime() + 30 * 60 * 1000); // Assume 30 minutes duration
            } else {
                // If parsing fails, use a generic future date/time
                startDate.setDate(startDate.getDate() + 3); // 3 days from now
                startDate.setHours(10, 0, 0, 0); // 10:00 AM
                endDate = new Date(startDate.getTime() + 30 * 60 * 1000);
            }

            const formattedStartDate = formatGoogleCalendarDateTime(startDate);
            const formattedEndDate = formatGoogleCalendarDateTime(endDate);

            return `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${eventTitle}&details=${eventDetails}&location=${location}&dates=${formattedStartDate}/${formattedEndDate}`;
        }

        /**
         * Calls the Gemini API to generate the auto-reply email content.
         * @param {string} applicantName - Applicant's name.
         * @param {string} applicantEmail - Applicant's email address.
         * @param {string} jobTitle - Applied job title.
         * @param {string} applicantGender - Applicant's gender.
         * @param {string} applicantAgeGroup - Applicant's age group.
         * @param {string} desiredInterviewDates - Desired interview dates provided by the applicant.
         * @returns {Promise<string>} Generated email body.
         */
        async function generateAutoReplyEmail(applicantName, applicantEmail, jobTitle, applicantGender, applicantAgeGroup, desiredInterviewDates) {
            let prompt = `
            ã‚ãªãŸã¯äººæç´¹ä»‹ä¼šç¤¾ã®æ¡ç”¨æ‹…å½“è€…ã§ã™ã€‚
            ä»¥ä¸‹ã®å¿œå‹Ÿè€…æƒ…å ±ã«åŸºã¥ã„ã¦ã€ä¸å¯§ãªè‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

            ---
            å¿œå‹Ÿè€…å: ${applicantName}
            å¿œå‹Ÿè€…ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${applicantEmail}
            å¿œå‹Ÿè·ç¨®: ${jobTitle}
            æ€§åˆ¥: ${applicantGender}
            å¹´ä»£: ${applicantAgeGroup}
            ---

            ä¸Šè¨˜ã®æ€§åˆ¥ã¨å¹´ä»£ã®æƒ…å ±ã‚’è€ƒæ…®ã—ã€ãƒ¡ãƒ¼ãƒ«ã®ãƒˆãƒ¼ãƒ³ã‚„è¡¨ç¾ã‚’é©åˆ‡ã«èª¿æ•´ã—ã¦ãã ã•ã„ã€‚
            ãŸã ã—ã€å¸¸ã«ä¸å¯§ã§ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªè¨€è‘‰é£ã„ã‚’ç¶­æŒã—ã€ä¸é©åˆ‡ãªè¡¨ç¾ã¯é¿ã‘ã¦ãã ã•ã„ã€‚
            ãƒ¡ãƒ¼ãƒ«ã®ä»¶åã¯ã€Œã€æ ªå¼ä¼šç¤¾ã€‡ã€‡ã€‘å¿œå‹Ÿå—ä»˜ã®ã”é€£çµ¡ã€ã¨ã—ã¦ãã ã•ã„ã€‚
            æœ¬æ–‡ã«ã¯ã€å¿œå‹Ÿã¸ã®æ„Ÿè¬ã€å¿œå‹ŸãŒæ­£å¸¸ã«å—ã‘ä»˜ã‘ã‚‰ã‚ŒãŸã“ã¨ã€ä»Šå¾Œã®é¸è€ƒã®æµã‚Œï¼ˆæ‹…å½“è€…ã‹ã‚‰æ”¹ã‚ã¦é€£çµ¡ã™ã‚‹ã“ã¨ï¼‰ã€
            ãã—ã¦å•ã„åˆã‚ã›å…ˆï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨é›»è©±ç•ªå·ï¼‰ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
            ä¼šç¤¾åã¯ã€Œæ ªå¼ä¼šç¤¾ã€‡ã€‡ã€ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Œexample@example.comã€ã€é›»è©±ç•ªå·ã¯ã€ŒXXX-XXXX-XXXXã€ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
            `;

            // å¸Œæœ›WEBé¢è«‡æ—¥ãŒå«ã¾ã‚Œã¦ã„ã‚Œã°ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è¿½åŠ 
            if (desiredInterviewDates.trim() !== '') {
                prompt += `

            å¿œå‹Ÿè€…æ§˜ã‚ˆã‚Šä»¥ä¸‹ã®WEBé¢è«‡å¸Œæœ›æ—¥ã‚’ã„ãŸã ã„ã¦ãŠã‚Šã¾ã™ã€‚
            ${desiredInterviewDates}
            ã“ã‚Œã‚‰ã®æ—¥ç¨‹ã‚’è€ƒæ…®ã—ã€é¢è«‡èª¿æ•´ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚
            `;
            }

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });

            const payload = { contents: chatHistory };
            const apiKey = "AIzaSyCr_lX9R0i9ywgwlyYzpUZwZWOS9yPFQ-c"; // Provided automatically in Canvas environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status} - ${errorData.error.message || response.statusText}`);
                }

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("APIã‹ã‚‰ã®å¿œç­”ãŒæœŸå¾…ã•ã‚Œã‚‹å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚");
                }
            } catch (error) {
                console.error("Gemini API call error:", error);
                throw new Error("è‡ªå‹•è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            }
        }

        /**
         * Handles form submission.
         */
        applicationForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission

            hideError(); // Hide error message
            emailOutput.classList.add('hidden'); // Hide previous email output
            googleCalendarLink.classList.add('hidden'); // Hide calendar link
            loadingIndicator.classList.remove('hidden'); // Show loading indicator

            const applicantName = document.getElementById('applicantName').value;
            const applicantEmail = document.getElementById('applicantEmail').value;
            const jobTitle = document.getElementById('jobTitle').value;
            const applicantGender = document.getElementById('applicantGender').value;
            const applicantAgeGroup = document.getElementById('applicantAgeGroup').value;
            const desiredInterviewDates = desiredInterviewDatesTextarea.value; // Get value from textarea

            try {
                const generatedEmail = await generateAutoReplyEmail(applicantName, applicantEmail, jobTitle, applicantGender, applicantAgeGroup, desiredInterviewDates);
                emailContent.textContent = generatedEmail;
                emailOutput.classList.remove('hidden'); // Show email output

                // Generate and show Google Calendar link
                const calendarUrl = createGoogleCalendarLink(applicantName, jobTitle, desiredInterviewDates);
                googleCalendarLink.href = calendarUrl;
                googleCalendarLink.classList.remove('hidden');

            } catch (error) {
                showError(error.message);
            } finally {
                loadingIndicator.classList.add('hidden'); // Hide loading indicator
            }
        });

        /**
         * Handles click on the close email output button.
         */
        closeEmailOutputButton.addEventListener('click', () => {
            emailOutput.classList.add('hidden');
            googleCalendarLink.classList.add('hidden'); // Hide calendar link when closing email output
            // Form reset is limited to completion of application
            // applicationForm.reset();
        });

        // Initialize Firebase when the window loads
        window.onload = initializeFirebase;
    </script>
</body>
</html>
